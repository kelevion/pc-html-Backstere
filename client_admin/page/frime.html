<!-- 框架页面 -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>测试单</title>
  <link rel="stylesheet" href="../layui/css/layui.css">
  <link rel="stylesheet" href="../css/diy.css">
</head>

<body>
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo layui-hide-xs layui-bg-black" id="echars">
        <a href="./Home.html" target="main_self_frame" style="color: white;">
          <i class="layui-icon layui-icon-home"></i>
          主页
        </a>
      </div>
      <!-- 头部区域（可配合layui 已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <!-- 移动端显示 -->
        <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
          <i class="layui-icon layui-icon-spread-left"></i>
        </li>
        <li>
          <h1>欢迎使用测试单</h1>
        </li>
      </ul>


      <ul class="layui-nav layui-layout-right" id="shopping" style="float: right;">
        <li class="layui-nav-item layui-hide layui-show-md-inline-block">
          <a href="./mall_center/table.html" target="main_self_frame" style="position: relative; z-index: 1;">商城中心</a>
        </li>

        <li class="layui-nav-item layui-hide layui-show-md-inline-block">
          <a href="./goods_type/table.html" target="main_self_frame" style="position: relative; z-index: 1;">分类列表</a>
        </li>

        <li class="layui-nav-item layui-hide layui-show-md-inline-block">
          <a href="./order/table.html" target="main_self_frame" style="position: relative; z-index: 1;">订单</a>
        </li>
      </ul>



    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
        <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
        <ul class="layui-nav layui-nav-tree" lay-filter="test2" id="uls">

          <li class="layui-nav-item" id="userInfo" style="display: block;">
            <a href="javascript:;">个人资料/Personal Data</a>
            <dl class="layui-nav-child">
              <dd><a href="./info.html" target="main_self_frame">个人信息</a></dd>
              <dd><a href="./change_password.html" target="main_self_frame">修改密码</a></dd>
            </dl>
          </li>

          <li class="layui-nav-item" id="site" style="display: none;">
            <a class="" href="javascript:;">公共管理/Public Manage</a>
            <dl class="layui-nav-child">
              <dd><a href="./slides/table.html" target="main_self_frame">轮播图</a></dd>
              <dd><a href="./notice/table.html" target="main_self_frame">公告栏</a></dd>
            </dl>
          </li>

          <li class="layui-nav-item" id="userManagement" style="display: none;">
            <a href="javascript:;">用户管理/User Manage</a>
            <dl class="layui-nav-child">
              <dd><a href="./user/table.html" target="main_self_frame">管理员</a></dd>
              <dd><a href="./mall_users/table.html" target="main_self_frame">商城用户</a></dd>
              <dd><a href="./seller/table.html" target="main_self_frame">卖家</a></dd>
            </dl>
          </li>


          <li class="layui-nav-item" id="content" style="display: none;">
            <a href="javascript:;">信息管理/Information Manage</a>
            <dl class="layui-nav-child">
              <dd><a href="./forum/table.html" target="main_self_frame">论坛</a></dd>
              <dd><a href="./forum_type/table.html" target="main_self_frame">论坛分类</a></dd>
              <dd><a href="./article/table.html" target="main_self_frame" id="article">文章</a></dd>
              <dd><a href="./article_type/table.html" target="main_self_frame" id="article_type"> 文章分类</a></dd>
              <dd><a href="./exam/table.html" target="main_self_frame">商城测试</a></dd>
            </dl>
          </li>

        </ul>
      </div>
    </div>

    <div class="layui-body">
      <!-- 内容主体区域 -->
      <iframe name="main_self_frame" frameborder="0" id="demoAdmin" src="./Home.html"
        style="width: 100%; height: 100%; border-radius: 2px;"></iframe>
    </div>
  </div>

  <script src="../layui/layui.js"></script>
  <script src="../js/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>

    let personInfo = JSON.parse(sessionStorage.personInfo)
    console.log(personInfo)


    let site = document.querySelector('#site')
    let userManagement = document.querySelector('#userManagement')
    let content = document.querySelector('#content')
    let shopping = document.querySelector('#shopping')
    let more = document.querySelectorAll('#more')

    if (personInfo.user_group == '管理员') {
      site.style.display = 'block'
      userManagement.style.display = 'block'
      content.style.display = 'block'
      shopping.style.display = 'block'
      more.forEach((item) => {
        item.style.display = 'block'
      })
    } else if (personInfo.user_group == '商城用户' || personInfo.user_group == '卖家') {
      content.style.display = 'block'
      shopping.style.display = 'block'
      more.forEach((item) => {
        item.style.display = 'block'
      })
    }


    // 更多管理请求
    async function get_list() {
      let { data: ren } = await axios.get('http://127.0.0.1:5000/api/auth/get_list', {
        params: {
          user_group: personInfo.user_group
        }
      })
      console.log(ren)

      var tables = ren.result.list;
      page_title('/article/table', 'article', tables)
      page_title('/article_type/table', 'article_type', tables)
      var lt = [];
      for (var i = 0; i < tables.length; i++) {
        var o = tables[i];
        if (o.path.indexOf("/table") !== -1) {
          let list = ["exam", "article", "article_type", , "comment", "goods", "order", "forum", "forum_type"];
          list.push("mall_center");
          list.push("mall_users");
          list.push("seller");
          if (list.indexOf(o.table_name) === -1) {
            lt.push(o);
          }
        }
      }

      let uls = document.querySelector('#uls')

      for (var i = 0; i <= lt.length - 1; i++) {


        let li = document.createElement('li')
        li.className = 'layui-nav-item'
        li.id = 'more'
        let a = document.createElement('a')
        li.appendChild(a);
        a.innerHTML = lt[i].page_title
        console.log(lt[i].path)
        a.href = "." + lt[i].path + ".html"
        a.setAttribute("target", 'main_self_frame')
        uls.appendChild(li)
      }

      layui.element.render('nav', 'test2')
      return lt
    }

    setTimeout(() => {
      let li = document.createElement('li')
      li.className = 'layui-nav-item'
      li.id = 'quit'
      let a = document.createElement('a')
      a.innerHTML = '退出/Exit'
      li.appendChild(a);
      uls.appendChild(li)

      layui.element.render('nav', 'test2')
    }, 200)

    layui.use(['element', 'layer', 'util'], function () {
      var element = layui.element
        , layer = layui.layer
        , util = layui.util
        , $ = layui.$;

      element.on("nav(test2)", function () {
        if ($(this).context.innerHTML == '退出/Exit') {
          let { data: res } = axios.get('http://127.0.0.1:5000/api/user/quit')
          window.location.replace("../index.html")
          sessionStorage.clear()
        }
      });
    });

    get_list()
  </script>
</body>

</html>